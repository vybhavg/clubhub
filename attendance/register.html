<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Registration</title>
    <style>
        .form-container {
            margin: 50px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 300px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>Event Registration</h2>
        <div id="registration">
            <h3>Register for Event</h3>
            <form id="registrationForm" action="submit_registration.php" method="POST">
                <input type="hidden" id="event_id" name="event_id" value="<!-- Your PHP Code to Inject Event ID -->">
                <input type="hidden" id="student_id" name="student_id" value="<!-- Your PHP Code to Inject Student ID -->">
                <button type="submit">Register</button>
            </form>
        </div>
        <div id="event-link" class="hidden">
            <p>Event registration link: <a href="<!-- Your Link Here -->">Register Here</a></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch('get_event_details.php') // Fetch event details from server
                .then(response => response.json())
                .then(data => {
                    const eventDuration = data.duration * 60 * 1000; // Convert minutes to milliseconds
                    const startTime = Date.now();
                    
                    if (navigator.geolocation) {
                        navigator.geolocation.watchPosition(
                            position => {
                                const userLocation = [position.coords.latitude, position.coords.longitude];
                                const eventLocation = [data.latitude, data.longitude];
                                
                                const distance = getDistance(userLocation, eventLocation);
                                
                                if (distance < 50) { // 50 meters radius
                                    if (Date.now() - startTime > eventDuration) {
                                        document.getElementById('registration').classList.remove('hidden');
                                        document.getElementById('event-link').classList.remove('hidden');
                                    }
                                }
                            },
                            error => {
                                console.error('Geolocation error:', error);
                            },
                            { enableHighAccuracy: true }
                        );
                    } else {
                        console.error('Geolocation not supported');
                    }

                    function getDistance(loc1, loc2) {
                        const R = 6371e3; // meters
                        const φ1 = loc1[0] * Math.PI / 180;
                        const φ2 = loc2[0] * Math.PI / 180;
                        const Δφ = (loc2[0] - loc1[0]) * Math.PI / 180;
                        const Δλ = (loc2[1] - loc1[1]) * Math.PI / 180;

                        const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                            Math.cos(φ1) * Math.cos(φ2) *
                            Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
                        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

                        return R * c;
                    }
                });
        });
    </script>
</body>
</html>
