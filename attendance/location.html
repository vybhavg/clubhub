<!DOCTYPE html>
<html>
<head>
    <title>Location Tracker</title>
    <script>
        function sendLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "track_location.php", true);
                    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                    // Ensure PHP variables are available
                    var student_id = <?php echo json_encode($_SESSION['student_id'] ?? ''); ?>;
                    var event_id = <?php echo json_encode($_SESSION['event_id'] ?? ''); ?>;
                    var email = <?php echo json_encode($_SESSION['email'] ?? ''); ?>;

                    // Prepare the data to be sent
                    var data = "student_id=" + encodeURIComponent(student_id) +
                               "&event_id=" + encodeURIComponent(event_id) +
                               "&latitude=" + encodeURIComponent(position.coords.latitude) +
                               "&longitude=" + encodeURIComponent(position.coords.longitude) +
                               "&student_email=" + encodeURIComponent(email);

                    // Handle response and errors
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === 4) {
                            if (xhr.status === 200) {
                                console.log("Location sent successfully.");
                            } else {
                                console.error("Error sending location:", xhr.statusText);
                            }
                        }
                    };

                    xhr.send(data);
                }, function(error) {
                    console.error("Error getting location:", error.message);
                });
            } else {
                console.error("Geolocation is not supported by this browser.");
            }
        }

        // Send location updates every 5 minutes
        setInterval(sendLocation, 5 * 60 * 1000); // 5 minutes
    </script>
</head>
<body>
    <h1>Tracking Location</h1>
</body>
</html>
